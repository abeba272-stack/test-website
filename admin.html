<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard – Parrylicious Studio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Allura&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="assets/logo.jpg" />
</head>
<body>
  <header class="topbar">
    <div class="container row">
      <a class="brand" href="home.html"><img src="assets/logo.jpg" alt="Parrylicious Studio Logo" class="logo"/></a>
      <nav class="nav">
        <a href="booking.html">Neue Buchung</a>
        <a class="btn small" href="home.html">Zur Website</a>
        <div data-profile-menu></div>
      </nav>
    </div>
  </header>

  <main class="section">
    <div class="container">
      <div class="section-head">
        <h2>Dashboard</h2>
        <p class="muted" id="dashboardHint">Lade Dashboard-Daten…</p>
        <div class="row gap">
          <span class="tag" id="roleBadge">Rolle: -</span>
          <span class="muted small" id="sessionUser"></span>
        </div>
      </div>

      <div class="dashboard-kpis">
        <article class="card kpi-card">
          <div class="kpi-label">Meine Termine</div>
          <div class="kpi-value" id="kpiBookings">0</div>
        </article>
        <article class="card kpi-card">
          <div class="kpi-label">Warteliste</div>
          <div class="kpi-value" id="kpiWaitlist">0</div>
        </article>
        <article class="card kpi-card">
          <div class="kpi-label">Offene Anzahlungen</div>
          <div class="kpi-value" id="kpiOpenPayments">0</div>
        </article>
      </div>

      <div class="two-col">
        <div class="card">
          <h3>Mein Profil</h3>
          <p class="muted">Diese Kundendaten werden in deinem Konto gespeichert.</p>
          <div class="profile-panel">
            <img id="profileAvatar" class="profile-avatar-lg" src="assets/logo.jpg" alt="Profilbild" />
            <div class="profile-avatar-actions">
              <label class="btn small ghost" for="profileAvatarUpload">Profilbild hochladen</label>
              <input id="profileAvatarUpload" type="file" accept="image/*" class="hidden" />
              <button class="btn small ghost" id="profileAvatarGenerate" type="button">Avatar erstellen</button>
              <button class="btn small ghost" id="profileAvatarRemove" type="button">Profilbild entfernen</button>
            </div>
          </div>

          <form class="form" id="profileForm">
            <input type="hidden" id="profileAvatarUrl" />
            <label>Vollständiger Name
              <input id="profileFullName" placeholder="z. B. Abeba Sundermann" />
            </label>
            <label>Telefon
              <input id="profilePhone" placeholder="z. B. +49..." />
            </label>
            <label>Adresse
              <input id="profileAddress" placeholder="Straße, Hausnummer, PLZ, Ort" />
            </label>
            <div class="row end gap">
              <button class="btn small" type="submit">Profil speichern</button>
            </div>
          </form>
          <div class="fineprint" id="profileStatus"></div>
        </div>

        <div class="card">
          <h3>Rollen & Rechte</h3>
          <div class="role-grid">
            <div class="role-row">
              <span class="pill">customer</span>
              <span class="muted small">Eigene Termine sehen, stornieren, Anzahlung zahlen.</span>
            </div>
            <div class="role-row">
              <span class="pill">staff</span>
              <span class="muted small">Alle Termine sehen, bestätigen und stornieren.</span>
            </div>
            <div class="role-row">
              <span class="pill">admin</span>
              <span class="muted small">Wie staff + Rollen anderer Benutzer verwalten.</span>
            </div>
          </div>
          <div class="divider"></div>
          <h3>Heute</h3>
          <div class="muted" id="today"></div>
          <div class="row gap" style="margin-top:12px">
            <button class="btn small" id="exportCsv">Export CSV</button>
            <button class="btn small ghost" id="clearData">Eigene Daten löschen</button>
          </div>
        </div>
      </div>

      <div class="card hidden" id="adminRoleCard">
        <h3>Admin: Rollenverwaltung</h3>
        <p class="muted">Benutzer per E-Mail einer Rolle zuweisen.</p>
        <form class="row gap admin-role-form" id="roleForm">
          <input id="roleEmail" type="email" placeholder="kunde@mail.de" required />
          <select id="roleSelect" required>
            <option value="customer">customer</option>
            <option value="staff">staff</option>
            <option value="admin">admin</option>
          </select>
          <button class="btn small" type="submit">Rolle setzen</button>
        </form>
        <div class="fineprint" id="roleStatus"></div>
        <div class="divider"></div>
        <div id="roleUsersTable" class="table"></div>
      </div>

      <div class="card">
        <div class="row between">
          <h3>Anfragen & Termine</h3>
          <div class="row gap">
            <select id="statusFilter">
              <option value="all">Alle</option>
              <option value="requested">Angefragt</option>
              <option value="confirmed">Bestätigt</option>
              <option value="canceled">Storniert</option>
            </select>
            <input id="search" placeholder="Suche Name/Service/Telefon…" />
          </div>
        </div>
        <div class="divider"></div>
        <div id="bookingsTable" class="table" aria-live="polite"></div>
      </div>

      <div class="card">
        <h3>Warteliste</h3>
        <div class="muted">Wenn ausgebucht: Kunden eintragen → später Slot anbieten.</div>
        <div class="divider"></div>
        <div id="waitlistTable" class="table"></div>
      </div>

    </div>
  </main>

  <footer class="footer">
    <div class="container footer-grid">
      <div class="footer-links">
        <a href="impressum.html">Impressum</a>
        <a href="privacy.html">Datenschutz</a>
      </div>
      <div class="muted">© <span id="year"></span> Parrylicious</div>
    </div>
  </footer>

  <script type="module" src="profile-menu.js"></script>
  <script type="module" src="admin.js"></script>
</body>
</html>
